\appendix
\section{Appendix: MATLAB scripts and data}
\label{app:matlab}

\subsection{Task 1}
\subsubsection{task1.m}

\begin{lstlisting}[language=Matlab]
x = linspace(-7,7,1000);
xq = quanti(x,7,2);
xq_4 = quanti(x,7,4);

figure;
plot(x,x,'b',x,xq,'r',x,xq_4,'y');
grid on

quantized_error = x - xq;
quantized_error_4b = x - xq_4;

figure;
plot(x,quantized_error, 'r', x, quantized_error_4b, 'y');
title('Quantization Error as a Function of Input Amplitude');
xlabel('Input Amplitude');
ylabel('Quantization Error');
grid on;
\end{lstlisting}

\subsection{Task 2}
\subsubsection{task2.m}

\begin{lstlisting}[language=Matlab]
FS = 5;
fs = 100e6;
f0 = 18.17e6;
M = 15 * 2^10;
t = (0:M-1)/fs;

A_list = [0.5, 0.75, 1.0, 1.03] * FS;
Nbits_list = [12, 10, 8, 6, 4];

results = [];

for A = A_list
    x = A * cos(2*pi*f0*t);
    sigma_x = A / sqrt(2);
    var_x_emp = var(x,1);
    for Nbits = Nbits_list
        LSB = FS / 2^(Nbits-1);
        xq = quanti(x, FS, Nbits);

        e = x - xq;
        var_e_emp = var(e,1);
        var_e_theor = LSB^2 / 12;

        SQNR_emp = 10*log10(var_x_emp / var_e_emp);
        SQNR_theor_formula = 6.02*Nbits + 4.77 - 20 * log10(FS / sigma_x);

        % Save
        results = [results; A, Nbits, var_e_emp, var_e_theor, SQNR_emp, SQNR_theor_formula];
    end
end
\end{lstlisting}


\subsection{Task 3}
\subsubsection{task3\_2.m}

\begin{lstlisting}[language=Matlab]

rng(0)

x0 = 1;
A = -x0; B = 0; C = +x0;

pd = makedist('Triangular','A',A,'B',B,'C',C);
N = 100000;
samples = random(pd, N, 1);

emp_mean = mean(samples);
emp_var = var(samples);
emp_desv_std = std(samples);

theo_var = (A^2 + B^2 + C^2 - A*B - A*C - B*C)/18;

rms = 20*log10(sqrt(emp_var)/x0);

fprintf('Theorical mean: 0; emp mean: %g\n',emp_mean);
fprintf('Theorical var: %.2f; emp var: %.2f\n',theo_var,emp_var);
fprintf('Sigma value: %.2f\n',sqrt(theo_var));
fprintf('rms value in dBFS: %g\n',rms)

xgrid = linspace(A,C,400)';
figure
histogram(samples,100,'Normalization','pdf', 'DisplayName', 'Generated samples')
hold on; grid on;

plot(xgrid, pdf(pd,xgrid), 'r-', 'LineWidth', 2, 'DisplayName', 'Theoretical PDF');

title('Symmetric Triangular Distribution - makedist');
xlabel('Value');
ylabel('PDF');
legend('Location','best');
hold off
\end{lstlisting}

\subsubsection{task3\_tri.m}
\begin{lstlisting}[language=Matlab]
rng(0);

x0 = 1;
sigma_x = x0 / sqrt(6);
N = 100000;

a = x0 / 2;

x1 = (2*rand(N,1) - 1) * a;
x2 = (2*rand(N,1) - 1) * a;
y = x1 + x2;

mean_y = mean(y);
var_y = var(y,1);
rms_dBFS = 20*log10(sqrt(var_y)/x0);

fprintf('--- Validation ---\n');
fprintf('Expected mean = 0\n');
fprintf('Sample mean   = %.5f\n\n', mean_y);

fprintf('Expected RMS [dBFS] = -7.78\n');
fprintf('Sample RMS   [dBFS] = %g\n', rms_dBFS);

figure;
histogram(y, 100, 'Normalization', 'pdf', 'DisplayName', 'Generated samples');
hold on; grid on;

x_pdf = linspace(-x0, x0, 400);
f_pdf = (x0 - abs(x_pdf)) / (x0^2);
plot(x_pdf, f_pdf, 'r-', 'LineWidth', 2, 'DisplayName', 'Theoretical PDF');

title('Symmetric Triangular Distribution - Sum 2 dist');
xlabel('Value');
ylabel('PDF');
legend('Location','best');
hold off;

\end{lstlisting}

\subsubsection{task3\_normal\_dist\_set.m}
\begin{lstlisting}[language=Matlab]
rng(0);

x0 = 1;
sigma_x = 10^(-9.54/20);
N = 100000;

x = sigma_x * randn(1, N);

emp_mean = mean(x);
emp_var  = var(x,1);
rms_dBFS = 20*log10(sqrt(emp_var)/x0);

fprintf('--- Validation ---\n');
fprintf('Expected mean = 0\n');
fprintf('Sample mean   = %g\n\n', emp_mean);

fprintf('Expected RMS [dBFS] = -9.54\n');
fprintf('Sample RMS   [dBFS] = %g\n', rms_dBFS);

figure;
histogram(x, 60, 'Normalization', 'pdf');
hold on; grid on;

xx = linspace(-4*sigma_x, 4*sigma_x, 400);
plot(xx, (1/(sigma_x*sqrt(2*pi))) * exp(-0.5*(xx/sigma_x).^2), 'r-', 'LineWidth',1.5);

title('Gaussian Distribution');
xlabel('Value');
ylabel('PDF');
legend('Empirical PDF','Theoretical');
grid on; hold off;
\end{lstlisting}

\subsection{Task 4}
\subsubsection{task4\_1.m}

\begin{lstlisting}[language=Matlab]
f0 = 37.1094e6;
M = 1024;
fs = 100e6;
Nbits = 12;
blocks = 15;
FS = 1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
Nsamples = blocks * M;

%% Generar FS sinusoidal
n = 0:Nsamples-1;
xt = FS * cos(2*n*pi*f0/fs);
xq = quanti(xt, FS, Nbits);

xqblocks = reshape(xq, M, 15);

X = fft(xqblocks, M);

P_avg = mean(abs(X).^2, 2);

norm_const = (M / 2)^2;
P_dbfs = 10 * log10(P_avg / norm_const);

f_axis = (0:M-1) * fs / M; 
plot(f_axis(1:M/2 + 1) / 1e6, P_dbfs(1:M/2 + 1));
grid on;
xlabel('Frequency (MHz)');
ylabel('Power (dBFS)');
title('Espectro de Potencia Promedio (N=12 bits, M=1024)');
ylim([-140, 10]);
\end{lstlisting}


\subsubsection{task4\_2.m}
\begin{lstlisting}[language=Matlab]
f0 = 37.1094e6;
M = 256;
fs = 100e6;
Nbits = 12;
blocks = 15;
FS = 1;

Nsamples = blocks * M;

%% Generar FS sinusoidal
n = 0:Nsamples-1;
xt = FS * cos(2*n*pi*f0/fs);
xq = quanti(xt, FS, Nbits);

xqblocks = reshape(xq, M, 15);

X = fft(xqblocks, M);

P_avg = mean(abs(X).^2, 2);

norm_const = (M / 2)^2;
P_dbfs = 10 * log10(P_avg / norm_const);

f_axis = (0:M-1) * fs / M;
plot(f_axis(1:M/2 + 1) / 1e6, P_dbfs(1:M/2 + 1));
grid on;
xlabel('Frequency (MHz)');
ylabel('Power (dBFS)');
title('Espectro de Potencia Promedio (N=12 bits, M=256)');
ylim([-140, 10]);
\end{lstlisting}


\subsubsection{task4\_3.m}
\begin{lstlisting}[language=Matlab]
f0 = 37.1094e6;
M = 1024;
fs = 100e6;
blocks = 15;
FS = 1;
Nsamples = blocks * M;
f_axis = (0:M-1) * fs / M;
norm_const = (M / 2)^2; 

n = 0:Nsamples-1;
xt = FS * cos(2*n*pi*f0/fs);

Nbits_list = [10, 8, 6];

for i = 1:length(Nbits_list)
    Nbits = Nbits_list(i);
    
    xq = quanti(xt, FS, Nbits);
    
    xqblocks = reshape(xq, M, blocks);
    X = fft(xqblocks, M);
    
    P_avg = mean(abs(X).^2, 2);
    P_dbfs = 10 * log10(P_avg / norm_const);
    
    sqnr_teorico = 6.02 * Nbits + 1.76;
    piso_ruido_teorico = -sqnr_teorico - 10*log10(M/2);
    
    figure;
    
    plot(f_axis(1:M/2 + 1) / 1e6, P_dbfs(1:M/2 + 1), 'b');
    hold on;
    yline(piso_ruido_teorico, 'r--', 'LineWidth', 1.5);
    hold off;
    
    grid on;
    xlabel('Frequency (MHz)');
    ylabel('Power (dBFS)');
    title(sprintf('Espectro (N = %d bits, M = 1024)', Nbits));
    ylim([-140, 10]);
    legend('Espectro medido', ...
           sprintf('Noise Floor (%.2f dBFS)', piso_ruido_teorico));
end
\end{lstlisting}


\subsubsection{task4\_4.m}
\begin{lstlisting}[language=Matlab]
f0 = 37.1094e6;
M = 1024;
fs = 100e6;
Nbits = 12;
blocks = 15;
FS = 1;

Nsamples = blocks * M;

n = 0:Nsamples-1;
xt = (1/3)*FS * cos(2*n*pi*f0/fs);
xq = quanti(xt, FS, Nbits);

xqblocks = reshape(xq, M, 15);

X = fft(xqblocks, M);

P_avg = mean(abs(X).^2, 2);

norm_const = (M / 2)^2;
P_dbfs = 10 * log10(P_avg / norm_const);

f_axis = (0:M-1) * fs / M; 
plot(f_axis(1:M/2 + 1) / 1e6, P_dbfs(1:M/2 + 1));
grid on;
xlabel('Frequency (MHz)');
ylabel('Power (dBFS)');
title('Espectro de Potencia Promedio (N=12 bits, M=1024)');
ylim([-140, 10]);
\end{lstlisting}

\subsubsection{task4\_5.m}
\begin{lstlisting}[language=Matlab]

f0 = 37.12e6;
M = 1024;
fs = 100e6;
Nbits = 16;
%blocks = 15;
blocks = 100;
FS = 1;

Nsamples = blocks * M;

n = 0:Nsamples-1;
xt = FS * cos(2*n*pi*f0/fs);
xq = quanti(xt, FS, Nbits);

xqblocks = reshape(xq, M, blocks);

X = fft(xqblocks, M);

P_avg = mean(abs(X).^2, 2);

norm_const = (M / 2)^2;
P_dbfs = 10 * log10(P_avg / norm_const);

f_axis = (0:M-1) * fs / M;
plot(f_axis(1:M/2 + 1) / 1e6, P_dbfs(1:M/2 + 1));
grid on;
xlabel('Frequency (MHz)');
ylabel('Power (dBFS)');
title('Espectro de Potencia Promedio (N=16 bits, M=1024)');
ylim([-140, 10]);
\end{lstlisting}

\subsection{Task 5}
\subsubsection{task5\_1.m}
\begin{lstlisting}[language=Matlab]
FS = 1;
x = linspace(-FS, FS, 1000);

g_0 = x;

gama_1 = 1;
g_1 = sign(x) .* (FS / log(1 + gama_1)) .* log(1 + gama_1 .* abs(x) / FS);
g_1(x == 0) = 0;

gama_2 = 2;
g_2 = sign(x) .* (FS / log(1 + gama_2)) .* log(1 + gama_2 .* abs(x) / FS);
g_2(x == 0) = 0;

figure;
plot(x, g_0, 'b', 'LineWidth', 2);
hold on;
plot(x, g_1, 'r', 'LineWidth', 2);
plot(x, g_2, 'g', 'LineWidth', 2);
grid on;
xlabel('x');
ylabel('g(x)');
title('Distortion Function g_\gamma(x)');
legend('\gamma = 0 (Ideal)', '\gamma = 1', '\gamma = 2');
\end{lstlisting}

\subsubsection{task5\_3.m}
\begin{lstlisting}[language=Matlab]

\end{lstlisting}


\subsubsection{task5\_4.m}
\begin{lstlisting}[language=Matlab]
f0 = 6.8359e6;
fs = 100e6;
FS = 1;
gamma_list = [0.01,0.1];
Nbits = 11;
M = 2048;
blocks = 15;

for gamma = gamma_list

    Nsamples = blocks * M;
    n = (0:Nsamples-1).';
    xt = FS * cos(2*pi*f0/fs * n);

    xq = dquanti(xt, FS, Nbits, gamma);
    xqblocks = reshape(xq, M, blocks);

    X = fft(xqblocks, M);

    P_avg = mean(abs(X).^2, 2);

    k0 = round(f0 * M / fs);
    n0 = (0:M-1).';
    xref = FS * cos(2*pi*(k0/M) * n0);
    Pref = max(abs(fft(xref, M)).^2);

    half = 1:(M/2);
    freqs = (half-1) * (fs / M);
    P_half = P_avg(half);

    P_dbfs = 10*log10( P_half / Pref );

    figure('Name',sprintf('M=%d, y=%.2f',M,gamma));
    plot(freqs/1e6, P_dbfs, 'LineWidth', 1.2);
    title(sprintf('PSD averaged, M=%d, N=%d, \\gamma=%.4g', M, Nbits, gamma));
    legend('PSD (avg)');
    grid on;
end

\end{lstlisting}

\subsubsection{task5\_5.m}
\begin{lstlisting}[language=Matlab]
f0 = 6.8359e6;
fs = 100e6;
FS = 1;
gamma_list = [0.005,0.05,0.1];
Nbits = 11;
M_list = [2048, 512];
blocks = 15;

for M = M_list
    for gamma = gamma_list
        Nsamples = blocks * M;
        n = (0:Nsamples-1).';
        xt = (FS/3) * cos(2*pi*f0/fs * n);
    
        xq = dquanti(xt, FS, Nbits, gamma);
        xqblocks = reshape(xq, M, blocks);
    
        X = fft(xqblocks, M);
    
        P_avg = mean(abs(X).^2, 2);
    
        k0 = round(f0 * M / fs);
        n0 = (0:M-1).';
        xref = FS * cos(2*pi*(k0/M) * n0);
        Pref = max(abs(fft(xref, M)).^2);
    
        half = 1:(M/2);
        freqs = (half-1) * (fs / M);
        P_half = P_avg(half);
    
        P_dbfs = 10*log10( P_half / Pref );
    
        figure('Name',sprintf('M=%d, y=%.2f',M,gamma));
        plot(freqs/1e6, P_dbfs, 'LineWidth', 1.2);
        title(sprintf('PSD averaged, M=%d, N=%d, \\gamma=%.4g', M, Nbits, gamma));
        legend('PSD (avg)');
        grid on;
    end
end
\end{lstlisting}

\subsubsection{task5\_6.m}
\begin{lstlisting}[language=Matlab]
f0 = 3.3202e6;
fs = 100e6;
FS = 1;
gamma = 0.3;
Nbits = 11;
M = 2048;
blocks = 15;

Nsamples = blocks * M;
n = (0:Nsamples-1).';
xt = (FS/2) * cos(2*pi*f0/fs * n);

xq = dquanti(xt, FS, Nbits, gamma);
xqblocks = reshape(xq, M, blocks);

X = fft(xqblocks, M);

P_avg = mean(abs(X).^2, 2);

k0 = round(f0 * M / fs);
n0 = (0:M-1).';
xref = FS * cos(2*pi*(k0/M) * n0);
Pref = max(abs(fft(xref, M)).^2);

half = 1:(M/2);
freqs = (half-1) * (fs / M);
P_half = P_avg(half);

P_dbfs = 10*log10( P_half / Pref );

figure('Name',sprintf('M=%d, y=%.2f',M,gamma));
plot(freqs/1e6, P_dbfs, 'LineWidth', 1.2);
title(sprintf('PSD averaged, M=%d, N=%d, \\gamma=%.4g', M, Nbits, gamma));
legend('PSD (avg)');
grid on;

\end{lstlisting}

\subsection{Task 6}
\subsubsection{task6\_3.m}
\begin{lstlisting}[language=Matlab]
fs = 100e6;
Nbits = 12;
FS = 1;
M = 1024;
blocks = 100;
Nsamples = M * blocks;

k0 = 410;
fc = k0 * fs / M;


sigma_list_ps = [10, 0.1];

f_axis = (0:M/2) * fs / M;

Pq_dBFS = -(6.02 * Nbits + 1.76);
Pq_linear = 10^(Pq_dBFS / 10);
FFT_gain_dB = 10 * log10(M / 2);

for sigma_ps = sigma_list_ps
    sigma_tau = sigma_ps * 1e-12;
    
    SNR_jitter_dB = 20 * log10(1 / (2 * pi * fc * sigma_tau));
    Pj_dBFS = -SNR_jitter_dB;
    Pj_linear = 10^(Pj_dBFS / 10);
    
    P_total_linear = Pq_linear + Pj_linear;
    P_total_dBFS = 10 * log10(P_total_linear);
    
    Expected_Floor_dBFS = P_total_dBFS - FFT_gain_dB;
    
    fprintf('--- Caso sigma = %.1f ps ---\n', sigma_ps);
    fprintf('  P_cuantizacion (Pq): %.2f dBFS\n', Pq_dBFS);
    fprintf('  P_jitter (Pj):       %.2f dBFS\n', Pj_dBFS);
    fprintf('  P_ruido_total:       %.2f dBFS\n', P_total_dBFS);
    fprintf('  Piso FFT Esperado:   %.2f dBFS\n', Expected_Floor_dBFS);
    
    if sigma_ps == 10
        floor_10ps = Expected_Floor_dBFS;
    else
        floor_0_1ps = Expected_Floor_dBFS;
    end
end


for sigma_ps = sigma_list_ps
    sigma_tau = sigma_ps * 1e-12;
    
    n = (0:Nsamples-1)';
    t_ideal = n / fs;
    
    a = sigma_tau * sqrt(3);
    tau_n = -a + (2 * a) * rand(Nsamples, 1);
    
    t_jittered = t_ideal + tau_n;
    
    xt = FS * cos(2 * pi * fc * t_jittered);
    
    xq = quanti(xt, FS, Nbits);
    
    xq_blocks = reshape(xq, M, blocks);
    
    X_fft = fft(xq_blocks, M);
    P_avg = mean(abs(X_fft).^2, 2);
    
    norm_const = (M / 2)^2;
    P_dbfs = 10 * log10(P_avg / norm_const);
    
    figure;
    plot(f_axis / 1e6, P_dbfs(1:M/2 + 1));
    hold on;
    
    if sigma_ps == 10
        yline(floor_10ps, 'r--', 'LineWidth', 2, ...
            'Label', sprintf('Piso Teorico (%.1f dBFS)', floor_10ps));
    else
        yline(floor_0_1ps, 'r--', 'LineWidth', 2, ...
            'Label', sprintf('Piso Teorico (%.1f dBFS)', floor_0_1ps));
    end
    
    grid on;
    title(sprintf('Efecto del Jitter (\\sigma_{\\tau} = %.1f ps), M=1024', sigma_ps));
    xlabel('Frecuencia (MHz)');
    ylabel('Potencia (dBFS)');
    ylim([-140, 10]);
    legend('Espectro Simulado', 'Piso Teorico Esperado');
end
\end{lstlisting}
