\appendix
\section{Appendix: MATLAB scripts and data}
\label{app:matlab}

\subsection{Task 4}
\subsubsection{task4\_1.m}

\begin{lstlisting}[language=Matlab]
f0 = 37.1094e6;
M = 1024;
fs = 100e6;
Nbits = 12;
blocks = 15;
FS = 1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
Nsamples = blocks * M;

%% Generar FS sinusoidal
n = 0:Nsamples-1;
xt = FS * cos(2*n*pi*f0/fs);
xq = quanti(xt, FS, Nbits);

xqblocks = reshape(xq, M, 15);

X = fft(xqblocks, M);

P_avg = mean(abs(X).^2, 2);

norm_const = (M / 2)^2;
P_dbfs = 10 * log10(P_avg / norm_const);

f_axis = (0:M-1) * fs / M; 
plot(f_axis(1:M/2 + 1) / 1e6, P_dbfs(1:M/2 + 1));
grid on;
xlabel('Frequency (MHz)');
ylabel('Power (dBFS)');
title('Espectro de Potencia Promedio (N=12 bits, M=1024)');
ylim([-140, 10]);
\end{lstlisting}


\subsubsection{task4\_2.m}
\begin{lstlisting}[language=Matlab]
f0 = 37.1094e6;
M = 256;
fs = 100e6;
Nbits = 12;
blocks = 15;
FS = 1;

Nsamples = blocks * M;

%% Generar FS sinusoidal
n = 0:Nsamples-1;
xt = FS * cos(2*n*pi*f0/fs);
xq = quanti(xt, FS, Nbits);

xqblocks = reshape(xq, M, 15);

X = fft(xqblocks, M);

P_avg = mean(abs(X).^2, 2);

norm_const = (M / 2)^2;
P_dbfs = 10 * log10(P_avg / norm_const);

f_axis = (0:M-1) * fs / M;
plot(f_axis(1:M/2 + 1) / 1e6, P_dbfs(1:M/2 + 1));
grid on;
xlabel('Frequency (MHz)');
ylabel('Power (dBFS)');
title('Espectro de Potencia Promedio (N=12 bits, M=256)');
ylim([-140, 10]);
\end{lstlisting}


\subsubsection{task4\_3.m}
\begin{lstlisting}[language=Matlab]
f0 = 37.1094e6;
M = 1024;
fs = 100e6;
blocks = 15;
FS = 1;
Nsamples = blocks * M;
f_axis = (0:M-1) * fs / M;
norm_const = (M / 2)^2; 

n = 0:Nsamples-1;
xt = FS * cos(2*n*pi*f0/fs);

Nbits_list = [10, 8, 6];

for i = 1:length(Nbits_list)
    Nbits = Nbits_list(i); % Nbits actual
    
    xq = quanti(xt, FS, Nbits);
    
    xqblocks = reshape(xq, M, blocks);
    X = fft(xqblocks, M);
    
    P_avg = mean(abs(X).^2, 2);
    P_dbfs = 10 * log10(P_avg / norm_const);
    
    sqnr_teorico = 6.02 * Nbits + 1.76;
    piso_ruido_teorico = -sqnr_teorico - 10*log10(M/2);
    
    figure;
    
    plot(f_axis(1:M/2 + 1) / 1e6, P_dbfs(1:M/2 + 1), 'b');
    hold on;
    yline(piso_ruido_teorico, 'r--', 'LineWidth', 1.5);
    hold off;
    
    grid on;
    xlabel('Frequency (MHz)');
    ylabel('Power (dBFS)');
    title(sprintf('Espectro (N = %d bits, M = 1024)', Nbits));
    ylim([-140, 10]);
    legend('Espectro medido', ...
           sprintf('Noise Floor (%.2f dBFS)', piso_ruido_teorico));
end
\end{lstlisting}


\subsubsection{task4\_4.m}
\begin{lstlisting}[language=Matlab]
f0 = 37.1094e6;
M = 1024;
fs = 100e6;
Nbits = 12;
blocks = 15;
FS = 1;

Nsamples = blocks * M;

n = 0:Nsamples-1;
xt = (1/3)*FS * cos(2*n*pi*f0/fs);
xq = quanti(xt, FS, Nbits);

xqblocks = reshape(xq, M, 15);

X = fft(xqblocks, M);

P_avg = mean(abs(X).^2, 2);

norm_const = (M / 2)^2;
P_dbfs = 10 * log10(P_avg / norm_const);

f_axis = (0:M-1) * fs / M; 
plot(f_axis(1:M/2 + 1) / 1e6, P_dbfs(1:M/2 + 1));
grid on;
xlabel('Frequency (MHz)');
ylabel('Power (dBFS)');
title('Espectro de Potencia Promedio (N=12 bits, M=1024)');
ylim([-140, 10]);
\end{lstlisting}

\subsubsection{task4\_5.m}
\begin{lstlisting}[language=Matlab]

f0 = 37.12e6;
M = 1024;
fs = 100e6;
Nbits = 16;
%blocks = 15;
blocks = 100;
FS = 1;

Nsamples = blocks * M;

n = 0:Nsamples-1;
xt = FS * cos(2*n*pi*f0/fs);
xq = quanti(xt, FS, Nbits);

xqblocks = reshape(xq, M, blocks);

X = fft(xqblocks, M);

P_avg = mean(abs(X).^2, 2);

norm_const = (M / 2)^2;
P_dbfs = 10 * log10(P_avg / norm_const);

f_axis = (0:M-1) * fs / M;
plot(f_axis(1:M/2 + 1) / 1e6, P_dbfs(1:M/2 + 1));
grid on;
xlabel('Frequency (MHz)');
ylabel('Power (dBFS)');
title('Espectro de Potencia Promedio (N=16 bits, M=1024)');
ylim([-140, 10]);
\end{lstlisting}
